<%- include('./partials/header.ejs'); %>

<div class="container text-center">
  <h1>Available Puppies</h1>
  <div class="container col-md-8 text-center">
    <div class="row row-cols-1 row-cols-md-2 g-4">

      <% for(var i=0; i < puppies.length; i++){ %>
      <div class="col">
        <div class="card">
          <h3><%= puppies[i].name %></h3>
          <div id=<%= `${puppies[i].name}-carousel` %> class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <% var firstImageIndex = imageURLs.findIndex(finder => finder.puppyid === puppies[i].id) %>
              <% if(firstImageIndex === -1){firstImageIndex = imageURLs.findIndex(finder => finder.puppyid === 0)}; %>
              <div class="carousel-item active">
                <img src=<%= `https://homestead-images.s3.us-east-2.amazonaws.com/${imageURLs[firstImageIndex].imageid}` %> class="d-block w-100" alt="...">
              </div>

              <% const filteredURLs = imageURLs.filter(finder => finder.puppyid === puppies[i].id);
              filteredURLs.splice(0,1)
              for(var j=0; j < filteredURLs.length; j++){ %>
              <div class="carousel-item">
                <img src= <%= `https://homestead-images.s3.us-east-2.amazonaws.com/${filteredURLs[j].imageid}` %> class="d-block w-100" alt="...">
              </div>
              <%}%>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target=<%= `#${puppies[i].name}-carousel` %> data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target=<%= `#${puppies[i].name}-carousel` %> data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
            <div class="card-body">
              <button type="button" class="btn btn-outline-info"><%= puppies[i].breed %></button>
              <ul class="list-group list-group-flush">
                <li class="list-group-item">Gender: <%= puppies[i].gender %></li>
                <% const dobInMS = Date.parse(puppies[i].dob)
                  const todayInMS = Date.now()
                  var ageInWeeks = Math.floor((todayInMS-dobInMS)/604800000)
                  var ageInDays = Math.floor(((todayInMS-dobInMS)%604800000)/86400000)
                  %>
                <li class="list-group-item">Age: <%= ageInWeeks %> Weeks and <%= ageInDays %> days</li>
                <% if(locals.puppies[i].price){%>
                <li class="list-group-item">Price: $<%= puppies[i].price %></li>
                <%} else {%>
                <li class="list-group-item">Price: Contact</li>
                <%}%>
                  <li class="list-group-item">Mother: <button type="button" class="btn"><%= puppies[i].mother %></button></li>
                <li class="list-group-item">Father: <button type="button" class="btn"><%= puppies[i].father %></button></li>
                </li>
              </ul>
              <div class="d-grid gap-2">
                <button class="btn btn-primary" type="button">{Statement About Bringing Me Home}</button>
              </div>
            </div>
          </div>
        </div>
        <% } %>
      </div>
    </div>
  </div>

  <%- include('./partials/footer.ejs'); %>